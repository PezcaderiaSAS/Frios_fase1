<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Recibo de Movimiento | ColdChain Pro</title>
    <style>
        :root {
            --primary-color: #1a237e;
            --accent-color: #2ecc71;
            --warning-color: #f59e0b;
            --text-main: #2c3e50;
            --border-light: #e0e0e0;
        }

        @page {
            size: letter portrait;
            margin: 1.5cm;
        }

        body {
            font-family: 'Segoe UI', 'Inter', -apple-system, sans-serif;
            color: var(--text-main);
            margin: 0;
            padding: 0;
            font-size: 11px;
            line-height: 1.3;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 20px;
            margin-bottom: 25px;
        }

        .logo-area h1 {
            margin: 0;
            font-size: 22px;
            color: var(--primary-color);
            letter-spacing: -0.5px;
            text-transform: uppercase;
            font-weight: 800;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 4px;
            font-weight: 800;
            text-transform: uppercase;
            font-size: 11px;
            color: white;
            letter-spacing: 0.5px;
        }

        .bg-in {
            background: var(--accent-color);
        }

        .bg-out {
            background: var(--warning-color);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 6px;
            border: 1px solid var(--border-light);
        }

        .info-item label {
            display: block;
            font-size: 9px;
            text-transform: uppercase;
            color: #7f8c8d;
            font-weight: 700;
            margin-bottom: 4px;
            letter-spacing: 0.5px;
        }

        .info-item span {
            font-weight: 700;
            font-size: 12px;
            color: #1e293b;
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 10px;
        }

        th {
            background-color: #f1f5f9;
            text-align: left;
            padding: 10px 8px;
            border-bottom: 2px solid var(--border-light);
            font-size: 10px;
            text-transform: uppercase;
            color: #64748b;
            font-weight: 700;
        }

        td {
            padding: 8px 8px;
            border-bottom: 1px solid var(--border-light);
            vertical-align: middle;
        }

        tr:nth-child(even) {
            background-color: #f8fafc;
        }

        .num {
            text-align: right;
            font-family: 'Consolas', monospace;
            font-weight: 600;
        }

        .fw-bold {
            font-weight: 700;
        }

        .total-row {
            background-color: #e2e8f0 !important;
            font-weight: 800;
            font-size: 12px;
            border-top: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .total-row td {
            padding: 12px 8px;
        }

        .signature-section {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
            page-break-inside: avoid;
        }

        .sig-box {
            width: 40%;
            border-top: 1px solid #94a3b8;
            text-align: center;
            padding-top: 8px;
            font-size: 10px;
            color: #64748b;
        }

        .footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            font-size: 9px;
            color: #94a3b8;
            text-align: center;
            border-top: 1px dashed #e2e8f0;
            padding-top: 10px;
        }

        .color-in {
            color: #166534;
        }

        .color-out {
            color: #b45309;
        }
    </style>
</head>

<body>
    <?
  // Pre-calculate values to avoid complex inline expressions
  var badgeClass = (data.tipo === 'ENTRADA') ? 'bg-in' : 'bg-out';
  var colorClass = (data.tipo === 'ENTRADA') ? 'color-in' : 'color-out';
  var fechaFormateada = new Date(data.fecha).toLocaleDateString('es-CO');
?>
    <div class="header">
        <div class="logo-area">
            <h1>COLDCHAIN <span style="font-size: 12px; font-weight: 400; color: #64748b; margin-left:5px;">ADVANCED
                    WMS</span></h1>
        </div>
        <div>
            <span class="badge <?= badgeClass ?>">RECIBO DE
                <?= data.tipo ?>
            </span>
        </div>
    </div>

    <div class="info-grid">
        <div class="info-item">
            <label>ID Movimiento</label>
            <span style="font-family:'Consolas', monospace;">
                <?= data.id ?>
            </span>
        </div>
        <div class="info-item">
            <label>Cliente Titular</label>
            <span>
                <?= data.cliente ?>
            </span>
        </div>
        <div class="info-item">
            <label>Fecha</label>
            <span>
                <?= fechaFormateada ?>
            </span>
        </div>
        <div class="info-item">
            <label>Documento Ref.</label>
            <span>
                <?= data.docReferencia || 'N/A' ?>
            </span>
        </div>
        <div class="info-item">
            <label>Responsable</label>
            <span style="font-size: 11px; font-weight: 400;">Operaciones ColdChain</span>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th width="40%">SKU / Producto</th>
                <th width="12%">Lote</th>
                <th width="12%">Vencimiento</th>
                <th width="12%" class="num">Cajas</th>
                <th width="12%" class="num">Peso (KG)</th>
                <th width="12%" class="num">Saldo Post</th>
            </tr>
        </thead>
        <tbody>
            <? for (var i = 0; i < data.items.length; i++) { 
               var item = data.items[i];
               var peso = parseFloat(item.pesoKg) || 0;
               var cajas = parseInt(item.cantidadCajas) || 0;
               var displayPeso = (data.tipo === 'SALIDA') ? -Math.abs(peso) : Math.abs(peso);
               var displayCajas = (data.tipo === 'SALIDA') ? -Math.abs(cajas) : Math.abs(cajas);
               var nombreProd = item.nombreProducto || item.idProducto || 'Producto';
               var empaqueProd = item.empaque || 'Estándar';
               var loteProd = item.lote || '-';
               var vencProd = item.fechaVencimiento ? new Date(item.fechaVencimiento).toLocaleDateString('es-CO') : '--';
               var saldo = item.stockRestante || '-';
            ?>
            <tr>
                <td>
                    <div class="fw-bold">
                        <?= nombreProd ?>
                    </div>
                    <div style="font-size: 9px; color:#64748b;">
                        <?= empaqueProd ?>
                    </div>
                </td>
                <td style="font-family:'Consolas', monospace;">
                    <?= loteProd ?>
                </td>
                <td>
                    <?= vencProd ?>
                </td>
                <td class="num">
                    <?= displayCajas ?>
                </td>
                <td class="num">
                    <?= displayPeso.toFixed(2) ?>
                </td>
                <td class="num <?= colorClass ?>">
                    <?= saldo ?>
                </td>
            </tr>
            <? } ?>
            <tr class="total-row">
                <td colspan="3">TOTALES DEL MOVIMIENTO</td>
                <td class="num">
                    <?= (data.tipo === 'SALIDA') ? -Math.abs(data.totalCajas) : data.totalCajas ?>
                </td>
                <td class="num">
                    <?= ((data.tipo === 'SALIDA') ? -Math.abs(data.totalPeso) : data.totalPeso).toFixed(2) ?>
                </td>
                <td></td>
            </tr>
        </tbody>
    </table>

    <div class="signature-section">
        <div class="sig-box">
            <div style="margin-bottom:40px;">&nbsp;</div>
            Entregado por<br>(Firma y Cédula)
        </div>
        <div class="sig-box">
            <div style="margin-bottom:40px;">&nbsp;</div>
            Recibido por<br>(Firma y Cédula)
        </div>
    </div>

    <div class="footer">
        Generado automáticamente por ColdChain Pro WMS | Página 1 de 1
    </div>
</body>

</html>